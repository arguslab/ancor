#!/usr/bin/env ruby
basedir = File.expand_path("../", File.dirname(__FILE__))

libdir = File.join(basedir, "lib")
plugindir = File.join(libdir, "mcollective")
vendordir = File.join(basedir, "vendor")

puts "Preparing portable install of MCollective at #{basedir}"

`rm -rf #{libdir}/mcollective`
`rm -rf #{vendordir}/marionette-collective`
`rm -rf #{vendordir}/mcollective-puppet-agent`
`rm -rf #{vendordir}/mcollective-puppetca-agent`

puts "Cloning required repositories"

`git clone -q git://github.com/ianunruh/marionette-collective.git -b 2.4.x #{vendordir}/marionette-collective`
`git clone -q git://github.com/puppetlabs/mcollective-puppet-agent.git #{vendordir}/mcollective-puppet-agent`
`git clone -q git://github.com/puppetlabs/mcollective-puppetca-agent.git #{vendordir}/mcollective-puppetca-agent`

puts "Installing plugins"

`ln -s #{vendordir}/marionette-collective/plugins/mcollective #{libdir}`

`cp -r #{vendordir}/mcollective-puppet-agent/agent #{plugindir}`
`cp -r #{vendordir}/mcollective-puppet-agent/util #{plugindir}`
`cp -r #{vendordir}/mcollective-puppetca-agent/agent #{plugindir}`
`cp -r #{vendordir}/mcollective-puppetca-agent/util #{plugindir}`

puts "Finished"
